# ๐ Telegram-ะฑะพั ะดะปั ะฐะฝะฐะปะธัะธะบะธ ะฒะธะดะตะพ

ะะพั, ะบะพัะพััะน ะพัะฒะตัะฐะตั ะฝะฐ ะฒะพะฟัะพัั ะพ ััะฐัะธััะธะบะต ะฒะธะดะตะพ ะฝะฐ ะตััะตััะฒะตะฝะฝะพะผ ััััะบะพะผ ัะทัะบะต ะธ ะฒะพะทะฒัะฐัะฐะตั ะพะดะฝะพ ัะธัะปะพ.

---

## ๐ ะัััััะน ััะฐัั (ะฑะตะท Docker)

### 1. ะะพะดะณะพัะพะฒะบะฐ ะพะบััะถะตะฝะธั

```bash
# ะะปะพะฝะธัะพะฒะฐะฝะธะต ัะตะฟะพะทะธัะพัะธั
git clone https://github.com/yourusername/video_analytics_bot.git
cd video_analytics_bot

# ะกะพะทะดะฐะฝะธะต ะฒะธัััะฐะปัะฝะพะณะพ ะพะบััะถะตะฝะธั
python -m venv venv
source venv/bin/activate  # Linux/macOS
# ะธะปะธ .\venv\Scripts\activate  # Windows

# ะฃััะฐะฝะพะฒะบะฐ ะทะฐะฒะธัะธะผะพััะตะน
pip install -r requirements.txt

# ะกะพะทะดะฐะฝะธะต .env ัะฐะนะปะฐ
cp .env.example .env
```

### 2. ะะฐัััะพะนะบะฐ ะฟะตัะตะผะตะฝะฝัั ะพะบััะถะตะฝะธั

ะัะบัะพะนัะต `.env` ะธ ะทะฐะฟะพะปะฝะธัะต:

```env
# Telegram Bot (ะฟะพะปััะธัั ัะตัะตะท @BotFather)
TELEGRAM_BOT_TOKEN=

# Database (PostgreSQL ะดะพะปะถะตะฝ ะฑััั ะทะฐะฟััะตะฝ ะปะพะบะฐะปัะฝะพ ะธะปะธ ัะตัะตะท Docker)
DB_HOST=localhost
DB_PORT=5432
DB_USER=postgres
DB_PASSWORD=postgres
DB_NAME=video_analytics

# YandexGPT (ะฟะพะปััะธัั ะฒ ะฏะฝะดะตะบั ะะฑะปะฐะบะต)
YANDEXGPT_API_KEY=
YANDEXGPT_FOLDER_ID=
```

---

## ๐๏ธ ะะฐะฟััะบ ะฑะฐะทั ะดะฐะฝะฝัั (PostgreSQL)

### ะะฐัะธะฐะฝั A: ะะพะบะฐะปัะฝะฐั ัััะฐะฝะพะฒะบะฐ PostgreSQL

1. ะกะพะทะดะฐะนัะต ะฑะฐะทั ะดะฐะฝะฝัั `video_analytics` ะธ ะฟะพะปัะทะพะฒะฐัะตะปั `postgres`
2. ะัะฟะพะปะฝะธัะต SQL-ัะบัะธะฟั ัะพะทะดะฐะฝะธั ัะฐะฑะปะธั:
   ```bash
   psql -h localhost -U postgres -d video_analytics -f sql/01_create_tables.sql
   ```

### ะะฐัะธะฐะฝั B: ะะฐะฟััะบ PostgreSQL ัะตัะตะท Docker (ัะตะบะพะผะตะฝะดัะตััั)

```bash
# ะะฐะฟััะบ ัะพะปัะบะพ PostgreSQL ะฒ ัะพะฝะต
docker run -d \
  --name video_analytics_db \
  -e POSTGRES_DB=video_analytics \
  -e POSTGRES_USER=postgres \
  -e POSTGRES_PASSWORD=postgres \
  -p 5432:5432 \
  -v $(pwd)/sql:/docker-entrypoint-initdb.d \
  postgres:15-alpine

# ะัะพะฒะตัะบะฐ ะณะพัะพะฒะฝะพััะธ (~30 ัะตะบัะฝะด ะพะถะธะดะฐะฝะธั)
sleep 30
```

---

## ๐ฅ ะะฐะณััะทะบะฐ ะดะฐะฝะฝัั ะธะท JSON

ะะพะผะตััะธัะต ัะฐะนะป `videos.json` ะฒ ะฟะฐะฟะบั `data/`, ะทะฐัะตะผ ะฒัะฟะพะปะฝะธัะต:

```bash
python scripts/load_json.py
```

ะกะบัะธะฟั ะฐะฒัะพะผะฐัะธัะตัะบะธ:
- ะัะพัะธัะฐะตั `data/videos.json`
- ะกะพะทะดะฐัั ะทะฐะฟะธัะธ ะฒ ัะฐะฑะปะธัะฐั `videos` ะธ `video_snapshots`
- ะะพะบะฐะถะตั ะบะพะปะธัะตััะฒะพ ะทะฐะณััะถะตะฝะฝัั ะทะฐะฟะธัะตะน

---

## ๐ค ะะฐะบ ะทะฐะดะฐัั ัะพะบะตะฝ Telegram-ะฑะพัะฐ

1. ะะฐะนะดะธัะต ะฒ Telegram `@BotFather`
2. ะัะฟัะฐะฒััะต ะบะพะผะฐะฝะดั `/newbot`
3. ะกะปะตะดัะนัะต ะธะฝััััะบัะธัะผ:
   - ะะฒะตะดะธัะต ะธะผั ะฑะพัะฐ (ะฝะฐะฟัะธะผะตั: `Video Analytics RL Bot`)
   - ะะฒะตะดะธัะต ัะทะตัะฝะตะนะผ (ะดะพะปะถะตะฝ ะพะบะฐะฝัะธะฒะฐัััั ะฝะฐ `bot`, ะฝะฐะฟัะธะผะตั: `video_analytics_rl_test_bot`)
4. ะกะบะพะฟะธััะนัะต ะฟะพะปััะตะฝะฝัะน ัะพะบะตะฝ ะฒะธะดะฐ:
   ```
   1234567890:AAHjKLmnOpQrStUvWxYzAbCdEfGhIjKlMnO
   ```
5. ะััะฐะฒััะต ัะพะบะตะฝ ะฒ `.env`:
   ```env
   TELEGRAM_BOT_TOKEN=1234567890:AAHjKLmnOpQrStUvWxYzAbCdEfGhIjKlMnO
   ```

---

## โถ๏ธ ะะฐะฟััะบ ะฑะพัะฐ

```bash
python bot/main.py
```

ะะพั ะฝะฐัะฝัั ะฟัะธะฝะธะผะฐัั ัะพะพะฑัะตะฝะธั ะฒ Telegram!

---

## ๐ง ะััะธัะตะบัััะฐ ะธ ะฟะพะดัะพะด ะบ ะฟัะตะพะฑัะฐะทะพะฒะฐะฝะธั ะทะฐะฟัะพัะพะฒ

### ะะฑัะฐั ััะตะผะฐ ัะฐะฑะพัั

```
ะะพะปัะทะพะฒะฐัะตะปั โ Telegram โ aiogram โ YandexGPT โ SQL โ PostgreSQL โ ะัะฒะตั (ัะธัะปะพ)
```

### ะะปััะตะฒัะต ะบะพะผะฟะพะฝะตะฝัั

| ะะพะผะฟะพะฝะตะฝั | ะขะตัะฝะพะปะพะณะธั | ะะฐะทะฝะฐัะตะฝะธะต |
|-----------|------------|------------|
| Telegram Bot | aiogram 3.12 | ะัะธัะผ ะธ ะพัะฟัะฐะฒะบะฐ ัะพะพะฑัะตะฝะธะน |
| ะะฐะทะฐ ะดะฐะฝะฝัั | PostgreSQL + asyncpg | ะฅัะฐะฝะตะฝะธะต ััะฐัะธััะธะบะธ ะฒะธะดะตะพ |
| LLM | YandexGPT API | ะัะตะพะฑัะฐะทะพะฒะฐะฝะธะต ัะตะบััะฐ ะฒ SQL |
| ะะฑัะฐะฑะพัะบะฐ ะดะฐั | ะะตะณัะปััะฝัะต ะฒััะฐะถะตะฝะธั | ะะพัะผะฐะปะธะทะฐัะธั ะดะฐั ั ััััะบะพะณะพ ะฝะฐ ISO |

### ะัะตะพะฑัะฐะทะพะฒะฐะฝะธะต ัะตะบััะฐ ะฒ SQL: 3-ััะฐะฟะฝัะน ะฟะพะดัะพะด

#### ะญัะฐะฟ 1: ะะพัะผะฐะปะธะทะฐัะธั ะดะฐั ะฝะฐ ััััะบะพะผ ัะทัะบะต
```python
# ะัะธะผะตั ะฟัะตะพะฑัะฐะทะพะฒะฐะฝะธั:
"28 ะฝะพัะฑัั 2025" โ "2025-11-28"
"ั 1 ะฟะพ 5 ะฝะพัะฑัั 2025" โ "ั 2025-11-01 ะฟะพ 2025-11-05"
```
ะะตะฐะปะธะทะพะฒะฐะฝะพ ัะตัะตะท ัะตะณัะปััะฝัะต ะฒััะฐะถะตะฝะธั ะฒ `bot/utils/llm.py::_normalize_dates()`.

#### ะญัะฐะฟ 2: ะะตะฝะตัะฐัะธั SQL ัะตัะตะท YandexGPT
- ะัะพะผะฟั ัะพะดะตัะถะธั **ะฟะพะปะฝัั ััะตะผั ะะ** ั ะพะฟะธัะฐะฝะธะตะผ ะฟะพะปะตะน ะธ ัะธะฟะพะฒ
- ะงััะบะธะต **ะฟัะฐะฒะธะปะฐ ะฒัะฑะพัะฐ ัะฐะฑะปะธั**:
  - `videos` โ ะดะปั ะธัะพะณะพะฒะพะน ััะฐัะธััะธะบะธ (ยซัะบะพะปัะบะพ ะฒะธะดะตะพยป, ยซะฝะฐะฑัะฐะปะพ ะฟัะพัะผะพััะพะฒยป)
  - `video_snapshots` โ ะดะปั ะดะธะฝะฐะผะธะบะธ (ยซะฝะฐ ัะบะพะปัะบะพ ะฒััะพัะปะพยป, ยซะฟัะธัะพััยป)
- ะัะธะผะตัั ะทะฐะฟัะพัะพะฒ ะดะปั ัะฝะธะถะตะฝะธั ะณะฐะปะปััะธะฝะฐัะธะน
- `temperature: 0.0` โ ะผะธะฝะธะผะธะทะฐัะธั ัะฒะพััะตัะบะธั ะพัะบะปะพะฝะตะฝะธะน

#### ะญัะฐะฟ 3: ะะตะทะพะฟะฐัะฝะพะต ะฒัะฟะพะปะฝะตะฝะธะต ะทะฐะฟัะพัะฐ
- ะัะธะฝััะพะฝะฝะพะต ะฒัะฟะพะปะฝะตะฝะธะต ัะตัะตะท `asyncpg`
- ะะทะฒะปะตัะตะฝะธะต ัะพะปัะบะพ ะฟะตัะฒะพะณะพ ะทะฝะฐัะตะฝะธั ะธะท ัะตะทัะปััะฐัะฐ
- ะะฑัะฐะฑะพัะบะฐ ะพัะธะฑะพะบ ะฑะตะท ัะฐัะบัััะธั ะดะตัะฐะปะตะน ะฟะพะปัะทะพะฒะฐัะตะปั

---

## ๐ค ะัะพะผะฟั ะดะปั YandexGPT

ะะพะปะฝัะน ะฟัะพะผะฟั (ัะพะบัะฐััะฝะฝะฐั ะฒะตััะธั ะดะปั ะดะพะบัะผะตะฝัะฐัะธะธ):

```
ะขั โ ัะธััะตะผะฐ ะฐะฝะฐะปะธัะธะบะธ ะฒะธะดะตะพ. ะัะตะพะฑัะฐะทัะน ะฒะพะฟัะพั ะฟะพะปัะทะพะฒะฐัะตะปั ะฒ ะะะะ ะบะพััะตะบัะฝัะน SQL-ะทะฐะฟัะพั ะฝะฐ PostgreSQL.

ะกะฅะะะ ะะะะซ ะะะะะซะฅ:

ะขะฐะฑะปะธัะฐ "videos" (ะธัะพะณะพะฒะฐั ััะฐัะธััะธะบะฐ ะฟะพ ะบะฐะถะดะพะผั ะฒะธะดะตะพ):
- id (BIGINT) โ ะธะดะตะฝัะธัะธะบะฐัะพั ะฒะธะดะตะพ
- creator_id (BIGINT) โ ะธะดะตะฝัะธัะธะบะฐัะพั ะบัะตะฐัะพัะฐ
- video_created_at (TIMESTAMP) โ ะดะฐัะฐ ะฟัะฑะปะธะบะฐัะธะธ ะฒะธะดะตะพ
- views_count (INTEGER) โ ัะธะฝะฐะปัะฝะพะต ะบะพะปะธัะตััะฒะพ ะฟัะพัะผะพััะพะฒ
- likes_count (INTEGER) โ ัะธะฝะฐะปัะฝะพะต ะบะพะปะธัะตััะฒะพ ะปะฐะนะบะพะฒ
- comments_count (INTEGER) โ ัะธะฝะฐะปัะฝะพะต ะบะพะปะธัะตััะฒะพ ะบะพะผะผะตะฝัะฐัะธะตะฒ
- reports_count (INTEGER) โ ัะธะฝะฐะปัะฝะพะต ะบะพะปะธัะตััะฒะพ ะถะฐะปะพะฑ

ะขะฐะฑะปะธัะฐ "video_snapshots" (ะฟะพัะฐัะพะฒัะต ะทะฐะผะตัั ััะฐัะธััะธะบะธ):
- video_id (BIGINT) โ ัััะปะบะฐ ะฝะฐ ะฒะธะดะตะพ
- delta_views_count (INTEGER) โ ะฟัะธัะพัั ะฟัะพัะผะพััะพะฒ ั ะฟัะพัะปะพะณะพ ะทะฐะผะตัะฐ
- delta_likes_count (INTEGER) โ ะฟัะธัะพัั ะปะฐะนะบะพะฒ ั ะฟัะพัะปะพะณะพ ะทะฐะผะตัะฐ
- delta_comments_count (INTEGER) โ ะฟัะธัะพัั ะบะพะผะผะตะฝัะฐัะธะตะฒ ั ะฟัะพัะปะพะณะพ ะทะฐะผะตัะฐ
- delta_reports_count (INTEGER) โ ะฟัะธัะพัั ะถะฐะปะพะฑ ั ะฟัะพัะปะพะณะพ ะทะฐะผะตัะฐ
- created_at (TIMESTAMP) โ ะฒัะตะผั ะทะฐะผะตัะฐ (ัะฐะท ะฒ ัะฐั)

ะะะะะะะ ะะะะะะะฆะะ ะะะะะะกะ:
1. ะ ะพัะฒะตัะต ะดะพะปะถะตะฝ ะฑััั ะขะะะฌะะ ะพะดะธะฝ SQL-ะทะฐะฟัะพั ะฑะตะท ะปะธัะฝะตะณะพ ัะตะบััะฐ
2. ะะฐะฟัะพั ะดะพะปะถะตะฝ ะฒะพะทะฒัะฐัะฐัั ะะะะะ ะะะะ ะงะะกะะ (ัะตัะตะท COUNT, SUM, AVG)
3. ะะปั ัะธะปัััะฐัะธะธ ะฟะพ ะดะฐัะฐะผ ะธัะฟะพะปัะทัะน: DATE(column) = 'ะะะะ-ะะ-ะะ'
4. "ะกะบะพะปัะบะพ ะฒะธะดะตะพ" โ ัะฐะฑะปะธัะฐ videos + COUNT(*)
5. "ะะฐ ัะบะพะปัะบะพ ะฒััะพัะปะพ/ะฟัะธัะพัั" โ ัะฐะฑะปะธัะฐ video_snapshots + SUM(delta_*_count)
6. "ะะฐะทะฝัะต ะฒะธะดะตะพ" โ COUNT(DISTINCT video_id)

ะะะะะะะซ:
ะะพะฟัะพั: "ะกะบะพะปัะบะพ ะฒัะตะณะพ ะฒะธะดะตะพ ะตััั ะฒ ัะธััะตะผะต?"
SQL: SELECT COUNT(*) FROM videos;

ะะพะฟัะพั: "ะะฐ ัะบะพะปัะบะพ ะฟัะพัะผะพััะพะฒ ะฒััะพัะปะธ ะฒัะต ะฒะธะดะตะพ 2025-11-28?"
SQL: SELECT SUM(delta_views_count) FROM video_snapshots WHERE DATE(created_at) = '2025-11-28';
```

### ะะพัะตะผั ััะพั ะฟะพะดัะพะด ัะฐะฑะพัะฐะตั

| ะัะพะฑะปะตะผะฐ | ะะตัะตะฝะธะต ะฒ ะฟัะพะผะฟัะต |
|----------|-------------------|
| ะะฐะปะปััะธะฝะฐัะธะธ | `temperature: 0.0` + ะฟัะธะผะตัั ั ะฟัะฐะฒะธะปัะฝัะผะธ ะทะฐะฟัะพัะฐะผะธ |
| ะะตะฟัะฐะฒะธะปัะฝัะน ะฒัะฑะพั ัะฐะฑะปะธัั | ะงััะบะธะต ะฟัะฐะฒะธะปะฐ: ยซัะบะพะปัะบะพ ะฒะธะดะตะพยป โ `videos`, ยซะฟัะธัะพััยป โ `video_snapshots` |
| ะัะธะฑะบะธ ั ะดะฐัะฐะผะธ | ะะพัะผะฐะปะธะทะฐัะธั ะฝะฐ ััััะบะพะผ ัะทัะบะต ะดะพ ะพัะฟัะฐะฒะบะธ ะฒ LLM |
| ะะธัะฝะธะน ัะตะบัั ะฒ ะพัะฒะตัะต | ะขัะตะฑะพะฒะฐะฝะธะต ยซะขะะะฌะะ ะพะดะธะฝ SQL-ะทะฐะฟัะพัยป + ะฟะพััะพะฑัะฐะฑะพัะบะฐ ัะตะณัะปััะบะฐะผะธ |

---

## ๐งช ะัะธะผะตัั ะทะฐะฟัะพัะพะฒ

ะะพั ะบะพััะตะบัะฝะพ ะพัะฒะตัะฐะตั ะฝะฐ:

| ะะฐะฟัะพั | ะขะธะฟ ะพัะฒะตัะฐ |
|--------|------------|
| `ะกะบะพะปัะบะพ ะฒัะตะณะพ ะฒะธะดะตะพ ะตััั ะฒ ัะธััะตะผะต?` | ะะฑัะตะต ะบะพะปะธัะตััะฒะพ (ะฝะฐะฟัะธะผะตั: `4281`) |
| `ะกะบะพะปัะบะพ ะฒะธะดะตะพ ะฝะฐะฑัะฐะปะพ ะฑะพะปััะต 100000 ะฟัะพัะผะพััะพะฒ ะทะฐ ะฒัั ะฒัะตะผั?` | ะกััััะธะบ ะฒะธะดะตะพ ั ััะปะพะฒะธะตะผ |
| `ะะฐ ัะบะพะปัะบะพ ะฟัะพัะผะพััะพะฒ ะฒ ััะผะผะต ะฒััะพัะปะธ ะฒัะต ะฒะธะดะตะพ 28 ะฝะพัะฑัั 2025?` | ะกัะผะผะฐ `delta_views_count` ะทะฐ ะดะฐัั |
| `ะกะบะพะปัะบะพ ัะฐะทะฝัั ะฒะธะดะตะพ ะฟะพะปััะฐะปะธ ะฝะพะฒัะต ะฟัะพัะผะพััั 27 ะฝะพัะฑัั 2025?` | `COUNT(DISTINCT video_id)` ั ัะธะปัััะพะผ |

> โ๏ธ **ะะฐะถะฝะพ:** ะะพั ะฒะพะทะฒัะฐัะฐะตั **ัะพะปัะบะพ ัะธัะปะพ**, ะฑะตะท ะดะพะฟะพะปะฝะธัะตะปัะฝะพะณะพ ัะตะบััะฐ.

---

## ๐ ะัะปะฐะดะบะฐ

### ะัะพะฒะตัะบะฐ ะฟะพะดะบะปััะตะฝะธั ะบ ะะ
```bash
# ะัะปะธ PostgreSQL ะทะฐะฟััะตะฝ ัะตัะตะท Docker
docker exec -it video_analytics_db psql -U postgres -d video_analytics -c "SELECT COUNT(*) FROM videos;"

# ะัะปะธ PostgreSQL ะปะพะบะฐะปัะฝัะน
psql -h localhost -U postgres -d video_analytics -c "SELECT COUNT(*) FROM videos;"
```

### ะขะตััะธัะพะฒะฐะฝะธะต ะฟัะพะผะฟัะฐ ะฑะตะท ะทะฐะฟััะบะฐ ะฑะพัะฐ
```bash
python test_pipeline.py
```

### ะัะพัะผะพัั ะปะพะณะพะฒ ะฑะพัะฐ
ะัะธ ะปะพะบะฐะปัะฝะพะผ ะทะฐะฟััะบะต ะฒัะต ะปะพะณะธ ะฒะธะดะฝั ะฒ ะบะพะฝัะพะปะธ:
```bash
python bot/main.py
```

---

## ๐ ะกัััะบัััะฐ ะฟัะพะตะบัะฐ

```
video_analytics_bot/
โโโ bot/
โ   โโโ main.py              # ะขะพัะบะฐ ะฒัะพะดะฐ
โ   โโโ handlers/
โ   โ   โโโ bot_handler.py   # ะะฑัะฐะฑะพัะบะฐ ัะพะพะฑัะตะฝะธะน Telegram
โ   โโโ utils/
โ       โโโ database.py      # ะัะธะฝััะพะฝะฝะฐั ัะฐะฑะพัะฐ ั PostgreSQL
โ       โโโ llm.py           # ะะปะธะตะฝั YandexGPT + ะฟัะพะผะฟั
โโโ sql/
โ   โโโ 01_create_tables.sql # ะกัะตะผะฐ ะฑะฐะทั ะดะฐะฝะฝัั
โโโ scripts/
โ   โโโ load_json.py         # ะะฐะณััะทะบะฐ ะดะฐะฝะฝัั ะธะท JSON
โโโ data/
โ   โโโ videos.json          # ะคะฐะนะป ั ะดะฐะฝะฝัะผะธ (ะฝะต ะฒะบะปัััะฝ ะฒ ัะตะฟะพะทะธัะพัะธะน)
โโโ requirements.txt         # ะะฐะฒะธัะธะผะพััะธ Python
โโโ .env.example             # ะจะฐะฑะปะพะฝ ะฟะตัะตะผะตะฝะฝัั ะพะบััะถะตะฝะธั
โโโ README.md                # ะญัะพั ัะฐะนะป
```

---



ะะฐะฟััะบ ะฟัะพะฒะตัะบะธ:
```
/check @ะฒะฐั_ะฑะพั https://github.com/ะฒะฐั_ัะทะตัะฝะตะนะผ/video_analytics_bot
```
